import jwtoken from 'jsonwebtoken';

const getTokenFromHeader = (header) => (!header ? '' : header.split(' ')[1]);
/**
 * JWT middleware
 */
const jwt = ({ secret, algorithm = 'HS256', audience = '', issuer = '', expiresIn = '50y', notBefore = '0s', requestHeaderName = 'authorization', responseHeaderName = 'X-Token', getToken = getTokenFromHeader }) => {
    return function (req, res, next) {
        var _a;
        const token = getToken((_a = req.headers[requestHeaderName]) !== null && _a !== void 0 ? _a : '');
        try {
            // Verify the JWT token
            const verify = jwtoken.verify(token, Array.isArray(secret) ? secret[1] : secret, {
                algorithms: [algorithm],
                audience,
                issuer
            });
            req.user = verify;
            res.setHeader(responseHeaderName, jwtoken.sign(req.user, Array.isArray(secret) ? secret[0] : secret, {
                audience,
                issuer,
                expiresIn,
                notBefore,
                algorithm
            }));
            next();
        }
        catch {
            next();
        }
    };
};

export { jwt };
